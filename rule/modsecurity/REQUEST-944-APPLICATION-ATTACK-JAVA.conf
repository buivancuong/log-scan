SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 1" "id:944011,phase:1,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 1" "id:944012,phase:2,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx java\.lang\.(?:runtime|processbuilder)" "id:944100,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',msg:'Remote Command Execution: Suspicious Java class detected',severity:'CRITICAL',t:none,t:lowercase,ver:'OWASP_CRS/3.2.0',setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/1',tag:'attack-rce'"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx (?:runtime|processbuilder)" "id:944110,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',chain,msg:'Remote Command Execution: Java process spawn (CVE-2017-9805)',severity:'CRITICAL',t:none,t:lowercase,ver:'OWASP_CRS/3.2.0',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/1',tag:'attack-rce'"
SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx (?:unmarshaller|base64data|java\.)" "setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}'"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx (?:clonetransformer|forclosure|instantiatefactory|instantiatetransformer|invokertransformer|prototypeclonefactory|prototypeserializationfactory|whileclosure|getproperty|filewriter|xmldecoder)" "id:944120,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',chain,msg:'Remote Command Execution: Java serialization (CVE-2015-5842)',severity:'CRITICAL',t:none,t:lowercase,ver:'OWASP_CRS/3.2.0',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/1',tag:'attack-rce'"
SecRule MATCHED_VARS "@rx (?:runtime|processbuilder)" "t:none,t:lowercase,setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}'"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_FILENAME|REQUEST_HEADERS|XML:/*|XML://@* "@pmFromFile java-classes.data" "id:944130,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',msg:'Suspicious Java class detected',severity:'CRITICAL',t:none,t:lowercase,ver:'OWASP_CRS/3.2.0',setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/1',tag:'attack-rce'"

SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 2" "id:944013,phase:1,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 2" "id:944014,phase:2,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx \xac\xed\x00\x05" "id:944200,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',msg:'Magic bytes Detected; probable java serialization in use',severity:'CRITICAL',ver:'OWASP_CRS/3.2.0',setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl2=+%{tx.critical_anomaly_score}',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/2',tag:'attack-rce'"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx (?:rO0ABQ|KztAAU|Cs7QAF)" "id:944210,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',msg:'Magic bytes Detected Base64 Encoded; probable java serialization in use',severity:'CRITICAL',ver:'OWASP_CRS/3.2.0',setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl2=+%{tx.critical_anomaly_score}',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/2',tag:'attack-rce'"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx (?:clonetransformer|forclosure|instantiatefactory|instantiatetransformer|invokertransformer|prototypeclonefactory|prototypeserializationfactory|whileclosure|getproperty|filewriter|xmldecoder)" "id:944240,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',msg:'Remote Command Execution: Java serialization (CVE-2015-5842)',severity:'CRITICAL',t:none,t:lowercase,ver:'OWASP_CRS/3.2.0',setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl2=+%{tx.critical_anomaly_score}',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/2',tag:'attack-rce'"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx java\b.+(?:runtime|processbuilder)" "id:944250,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',msg:'Remote Command Execution: Suspicious Java method detected',severity:'CRITICAL',t:lowercase,ver:'OWASP_CRS/3.2.0',setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl2=+%{tx.critical_anomaly_score}',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/2',tag:'attack-rce'"

SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 3" "id:944015,phase:1,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 3" "id:944016,phase:2,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecRule ARGS|ARGS_NAMES|REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_BODY|REQUEST_HEADERS|XML:/*|XML://@* "@rx (?:cnVudGltZQ|HJ1bnRpbWU|BydW50aW1l|cHJvY2Vzc2J1aWxkZXI|HByb2Nlc3NidWlsZGVy|Bwcm9jZXNzYnVpbGRlcg|Y2xvbmV0cmFuc2Zvcm1lcg|GNsb25ldHJhbnNmb3JtZXI|BjbG9uZXRyYW5zZm9ybWVy|Zm9yY2xvc3VyZQ|GZvcmNsb3N1cmU|Bmb3JjbG9zdXJl|aW5zdGFudGlhdGVmYWN0b3J5|Gluc3RhbnRpYXRlZmFjdG9yeQ|BpbnN0YW50aWF0ZWZhY3Rvcnk|aW5zdGFudGlhdGV0cmFuc2Zvcm1lcg|Gluc3RhbnRpYXRldHJhbnNmb3JtZXI|BpbnN0YW50aWF0ZXRyYW5zZm9ybWVy|aW52b2tlcnRyYW5zZm9ybWVy|Gludm9rZXJ0cmFuc2Zvcm1lcg|BpbnZva2VydHJhbnNmb3JtZXI|cHJvdG90eXBlY2xvbmVmYWN0b3J5|HByb3RvdHlwZWNsb25lZmFjdG9yeQ|Bwcm90b3R5cGVjbG9uZWZhY3Rvcnk|cHJvdG90eXBlc2VyaWFsaXphdGlvbmZhY3Rvcnk|HByb3RvdHlwZXNlcmlhbGl6YXRpb25mYWN0b3J5|Bwcm90b3R5cGVzZXJpYWxpemF0aW9uZmFjdG9yeQ|d2hpbGVjbG9zdXJl|HdoaWxlY2xvc3VyZQ|B3aGlsZWNsb3N1cmU)" "id:944300,phase:2,block,log,logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',msg:'Base64 encoded string matched suspicious keyword',severity:'CRITICAL',t:none,ver:'OWASP_CRS/3.2.0',setvar:'tx.rce_score=+%{tx.critical_anomaly_score}',setvar:'tx.anomaly_score_pl3=+%{tx.critical_anomaly_score}',tag:'application-multi',tag:'language-java',tag:'platform-multi',tag:'OWASP_CRS',tag:'OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION',tag:'WASCTC/WASC-31',tag:'OWASP_TOP_10/A1',tag:'PCI/6.5.2',tag:'paranoia-level/3',tag:'attack-rce'"

SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 4" "id:944017,phase:1,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecRule TX:EXECUTING_PARANOIA_LEVEL "@lt 4" "id:944018,phase:2,pass,nolog,skipAfter:END-REQUEST-944-APPLICATION-ATTACK-JAVA"

SecMarker END-REQUEST-944-APPLICATION-ATTACK-JAVA

